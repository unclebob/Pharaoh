/*  * pyramid.c -- Functions having to do with the pyramid  */  #include <std.h>#include <math.h>#include <quickdraw.h>#include <window.h>#include "strings.h"#define ROOT3 (1.732050808)	/* the square root of 3 *//*  * The Pyramid  *-----------------  *  * The pyramid which is built by the pharaoh is modelled as a two dimensional equilateral   * triangle.  Each stone placed into the pyramid represents a single unit of area in the triangle.  * As stones are added, area increases.  *  * The following routines compute the various parameters of the triangle based on its known  * base length.  *  */	/*ÇPyMaxÈ  * PyMax(b) -- given the length of the base of the pyramid, compute its maximum height when  *			 complete.  */  DOUBLE PyMax(b)DOUBLE b;	{	return((ROOT3/2)*b);	}  /*ÇPyHeightÈ  * PyHeight(b,a) -- Function determines the height of the pyramid based on its base and area  */  DOUBLE PyHeight(b,a)DOUBLE b,a;	{	DOUBLE h, determinant, maxH;		/* compute the maximum possible height */	maxH = PyMax(b);	/* make sure the area is realistic with respect ot the base */		if (a > (ROOT3/4)*b*b)	/* A greater then max area possible */		{		return(maxH);	/* return max height possible */		}		/* make sure we don't go imaginary */	determinant = b*b - 4*a/ROOT3;	if (determinant < 0)		return(0);		/* compute the height */	h = (b-sqrt(determinant)) / (2/ROOT3);		return(min(h, maxH));	}	/*ÇPyPolyÈ  * PyPoly -- create a polygon which outlines a partial pyramid.  *			b	Number of stones in the base  *			h	Number of stone units in height (stones are square)  *			tl	A rectangle whose top-left corner coincides with the pyramids enclosing rect  *			br	A rectangle whose bottom left coincides with the pyramids enclosing rect  */  PolyHandle PyPoly(b,h, tl, br)DOUBLE b,h;Rect *tl, *br;	/* cell rectangles at the top left and bottom right of the pyramid area */	{	Point b1, b2, t1, t2, m1, m2;	DOUBLE t, dt, scale, maxH;	PolyHandle poly;	COUNT displacement;		/* restrict the size of the pyramid to the maximum */	maxH = PyMax(b);	h = min(h, maxH);		displacement = br->right - tl->left;	scale = ((DOUBLE)displacement)/b;	scale *= .9; /* fudge */		b *= scale;	h *= scale;		SetPt(&b1, 0, 0);	SetPt(&b2, (COUNT)b,0);	  	t = b - 2*h/ROOT3;	dt = (b-t)/2;		SetPt(&t1, (COUNT)dt, -(COUNT)ceil(h));	SetPt(&t2, (COUNT)(t+dt), -(COUNT)floor(h));		SetPt(&m1, (COUNT)((h - floor(h)) * t + dt), t1.v);	SetPt(&m2, m1.h, t2.v);		poly = OpenPoly();	MoveTo(b1.h, b1.v);	LineTo(t1.h, t1.v);	LineTo(m1.h, m1.v);	LineTo(m2.h, m2.v);	LineTo(t2.h, t2.v);	LineTo(b2.h, b2.v);	LineTo(b1.h, b1.v);		ClosePoly();	OffsetPoly(poly, (COUNT)(tl->left+((displacement - b)/2)), br->bottom-2);	return(poly);	}	/*ÇCheckWinÈ  * CheckWin -- 	Check to see if the pyramid is complete.  If it is, then congratulate the  *				player and sign off  */  VOID CheckWin()	{	IMPORT DOUBLE pyHeight, pyBase;		if (pyHeight+1 > PyMax(pyBase))	/* are we as big as we can get? */		{		SaySt(ST_YOUWIN);		WinAlert();		exit();		}	}	