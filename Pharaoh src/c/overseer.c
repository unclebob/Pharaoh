/*  * overseer.c -- This module contains all the functions which perform requested actions  */  #include <std.h>#include <quickdraw.h>#include <dialog.h>#include <event.h>#include <control.h>#include <math.h>#include "vars.h"#include "pharaoh.h"#include "random.h"#include "strings.h"/* local variables */BOOL hireFlag=NO, fireFlag=NO, obtainFlag=NO;ControlHandle hireRb, fireRb, keepRb, obtainRb;/*ÇDoOverseerÈ  * DoOverseer -- control the overseer dialog box  */  VOID DoOverseer()	{	DialogRecord d;	BITS item;	DOUBLE transAmt;	Rect r;		hireFlag = fireFlag = obtainFlag = NO;	GetNewDialog(D_OVERSEER, &d, -1L);		GetDItem(&d, DIOV_HIRE, &item, &hireRb, &r);	GetDItem(&d, DIOV_FIRE, &item, &fireRb, &r);	GetDItem(&d, DIOV_OBTN, &item, &obtainRb, &r);			FOREVER		{		pascal short OVFilter();				ModalDialog(&OVFilter, &item);				if (item == DI_CANCEL)			break;		else if (item==DIOV_HIRE || item==DIOV_FIRE || item==DIOV_OBTN)			{			SetCtlValue(hireRb, hireFlag = (item==DIOV_HIRE));			SetCtlValue(fireRb, fireFlag = (item==DIOV_FIRE));			SetCtlValue(obtainRb, obtainFlag = (item==DIOV_OBTN));			}		else if (item == DI_OK)			{			TEXT num[256]; /* dialog edits can't return anything bigger */			BITS x;			Handle editHandle;			DOUBLE atof(), newOverseers = overseers;						GetDItem(&d, DIOV_EDIT, &x, &editHandle, &r);			GetIText(editHandle, &num);			ptoc(&num);						if (!IsNumeric(&num))				{				ErrorStr(ST_OVIN); 				continue;				}							if (!(hireFlag || fireFlag || obtainFlag))				{				ErrorStr(ST_OVSF);				continue;				}							transAmt = atof(&num);			if (transAmt - floor(transAmt) > 0)				{				ErrorStr(ST_OVFRAC);				continue;				}							if (hireFlag)				newOverseers += transAmt;				else if (fireFlag)				newOverseers -= transAmt;			else if (obtainFlag)				newOverseers = transAmt;						/* now do a little error checking */			if (newOverseers < 0)				{				ErrorStr(ST_OVFIRE);				SelIText(&d, DIOV_EDIT, 0, 32767);				continue;				}							overseers = newOverseers;			break;			}		}			CloseDialog(&d);	}		/*ÇOVFilterÈ  * OVFilter  -- 	the filter proc for the Overseer dialog.  Checks the flags to see if a function  * 				has been selected.  If not, the h,f,or o keys will select one.  */  pascal short OVFilter(d, e, item)DialogPtr d;EventRecord *e;BITS *item;	{	if (e->what == keyDown && ((TEXT)e->message) == '\r')		{		*item = DI_OK;		return(pTRUE);		}	if (hireFlag || fireFlag || obtainFlag)		return(pFALSE);	if (e->what == keyDown)		{		TEXT c;		c = e->message;		c = tolower(c);		if (c == 'h')			{			*item = DIOV_HIRE;			return(pTRUE);			}		if (c == 'f')			{			*item = DIOV_FIRE;			return(pTRUE);			}		if (c == 'o')			{			*item = DIOV_OBTN;			return(pTRUE);			}		return(pFALSE);		}	return(pFALSE);	}