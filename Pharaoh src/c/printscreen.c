/* * This function prints the screen for the pharaoh game. */ #include <std.h>#include <math.h>#include <quickdraw.h>#include <window.h>#include <font.h>#include "vars.h"#include "cells.h"#define DP(new, old) ((floor(new) - floor(old))/floor(old)*100)	/*«Local Storage»  * Local memory for printscreen  */  LOCAL BOOL cellInit = NO;GLOBAL COUNT testEvent;GLOBAL BOOL debugFlag = NO;Rect screenCells[XCELLS][YCELLS];/*«PrintScreen»  * PrintScreen -- refresh the Pharaoh main screen  */  VOID PrintScreen()	{	TEXT wrk[20];		TextFont(geneva);	TextFace(0);	TextSize(9);			if (!cellInit)		CellInit();	StatusLight("Printing...");		CellHeaders();		/* Print Commodities */		PrintFloat(wheat, 			C_WT);	PrintFloat(DP(wheat, olWt), 	C_DPWT);	PrintFloat(olWt,			C_OWT);	PrintFloat(manure, 			C_MN);	PrintFloat(DP(manure, olMn), 	C_DPMN);	PrintFloat(olMn,			C_OMN);	PrintInt(slaves, 			C_SL);	PrintFloat(DP(slaves, olSl), 	C_DPSL);	PrintInt(olSl,				C_OSL);	PrintInt(horses, 			C_HS);	PrintFloat(DP(horses, olHs), 	C_DPHS);	PrintInt(olHs,				C_OHS);	PrintInt(oxen, 				C_OX);	PrintFloat(DP(oxen, olOx), 	C_DPOX);	PrintInt(olOx,				C_OOX);		/* print market prices */		PrintFloat(wtPrice,			C_WTPRICE);	PrintFloat(mnPrice,			C_MNPRICE);	PrintFloat(slPrice,			C_SLPRICE);	PrintFloat(hsPrice,			C_HSPRICE);	PrintFloat(oxPrice,			C_OXPRICE);	PrintFloat(lnPrice, 			C_LNPRICE);		/* print Feed Rates */		PrintFloat(slFeedRt, 			C_SLFEED);	PrintFloat(oxFeedRt,			C_OXFEED);	PrintFloat(hsFeedRt,			C_HSFEED);		/* print overseer data */		PrintInt(overseers,			C_OV);	PrintFloat(ovPay, 			C_OVPAY);		/* Print Gold Data */		PrintFloat(gold,			C_GOLD);	PrintFloat(DP(gold, oldGold), 	C_DPGOLD);	PrintFloat(oldGold,			C_OLDGOLD);		/* Print Loan Data */	PrintFloat(interest+intAddition,C_INTEREST);	PrintFloat(loan,			C_LOAN);	PrintFloat(creditLimit,		C_CREDLIM);		/* print land data */		PrintFloat(lnFallow,			C_LNFALLOW);	PrintFloat(lnSewn,			C_LNSEWN);	PrintFloat(lnGrown,			C_LNGROWN);	PrintFloat(lnRipe,			C_LNRIPE);	PrintFloat(lnFallow+lnSewn+			lnGrown+lnRipe,	C_LNTOTAL);		PrintFloat(mnToSprd,		C_MNTOSPRD);	PrintFloat(lnToSew,			C_LNTOSEW);		/* print date */		PrintInt((DOUBLE)year,		C_YEAR);	PrintCell(monthName[(COUNT)month],	C_MONTH);		/* Print Pyramid */		PrintInt(pyQuota, 			C_PYQUOTA);	PrintInt(pyStones,			C_PYSTONES);	PrintFloat(pyHeight,			C_PYHEIGHT);	DrawPyramid(pyBase, pyHeight, CB_TLPY, CB_BRPY);	/* debug values */	if (debugFlag)		{		PrintFloat(slHealth, 		C_SLHEALTH);		PrintFloat(hsHealth, 		C_HSHEALTH);		PrintFloat(oxHealth, 	C_OXHEALTH);		PrintFloat(ovPress, 		C_OVPRESS);		PrintFloat(slFed,		C_SLFED);		PrintFloat(hsFed,		C_HSFED);		PrintFloat(oxFed,		C_OXFED);		PrintFloat(maxWk_sl,	C_MAXWK_SL);		PrintFloat(reqWk,		C_REQWK);		PrintFloat(slEff,		C_SLEFF);		PrintFloat(slLabor,		C_SLLABOR);		PrintFloat(slLashRt,		C_SLLASHRT);		PrintFloat(slSickRt,		C_SLSICKRT);		PrintFloat(sythed,		C_SYTHED);		PrintFloat(totWk,		C_TOTWK);		PrintFloat(wkDeff_sl,	C_WKDEFF_SL);		PrintFloat(wkHsTend,	C_WKHSTEND);		PrintFloat(wkMnSprd,	C_WKMNSPRD);		PrintFloat(wkOxTend,	C_WKOXTEND);		PrintFloat(wkWtHvst,	C_WKWTHVST);		PrintFloat(wkWtSew,	C_WKWTSEW);		PrintFloat(wkWtTend,	C_WKWTTEND);		PrintFloat(wtEff,		C_WTEFF);		PrintFloat(wtLost,		C_WTLOST);		PrintFloat(reqWk_sl,	C_RQWK_SL);		PrintFloat(posMotive,	C_POSMOTIVE);		PrintFloat(negMotive,	C_NEGMOTIVE);		PrintFloat(oxEff,		C_OXEFF);		PrintFloat(hsEff,		C_HSEFF);		PrintFloat(oxMult,		C_OXMULT);		PrintFloat(wkAble_sl,	C_WKABLE_SL);		PrintFloat(wtSupply,	C_WTSUPPLY);		PrintFloat(wtDemand,	C_WTDEMAND);		PrintFloat(wtProduction,	C_WTPROD);		PrintFloat(wtSewn,		C_WTSEWN);		PrintFloat(wtGrown,		C_WTGROWN);		PrintFloat(wtRipe,		C_WTRIPE);		}			else /* !debugFlag */		PrintContracts();		StatusLight("");	}	/*«Initialize the screen cells»  * Initialize the screen cells   */LOCAL Rect cellFrame;VOID CellInit()	{	FAST COUNT x, y;	cellInit = YES;	scr_clear();	for (x=0; x<XCELLS; x++)		for (y=0; y<YCELLS; y++)			{			SetRect(&screenCells[x][y], 				x*CELLWIDTH+FRAMEX, 			y*CELLHEIGHT+FRAMEY,				(x+1)*CELLWIDTH+(FRAMEX-1),		(y+1)*CELLHEIGHT+(FRAMEY-1));			}				SetRect(&cellFrame,			screenCells[0][0].left, 			screenCells[0][0].top,			screenCells[XCELLS-1][YCELLS-1].right,				screenCells[XCELLS-1][YCELLS-1].bottom);				InsetRect(&cellFrame, -4, -4);	}/*«CellHeaders»  * CellHeaders -- print the cell names and frames  */  VOID CellHeaders()	{	TEXT wrk[20];				TextSize(9);	TextFont(geneva);	TextFace(boldStyle);		/* Draw and paint the Frame */		FillRect(&cellFrame, gray);	PenSize(2,2);	FrameRect(&cellFrame);	PenNormal();		/* Draw the asset frame and guidelines */		CellRect(CB_TLCM, CB_BRCM, "Commodities");	PrintCell("Current", 	CH_CUR);	PrintCell("    ∂%", 		CH_DP);	PrintCell("   Old", 		CH_OLD);	PrintCell("Wheat",		CH_WT);	PrintCell("Manure", 		CH_MN);	PrintCell("Slaves", 		CH_SL);	PrintCell("Horses", 		CH_HS);	PrintCell("Oxen", 		CH_OX);		/* now draw the Market value frame */		CellRect(CB_TLPR, CB_BRPR, "Prices");	PrintCell("Wheat",		CH_WTPRICE);	PrintCell("Manure", 		CH_MNPRICE);	PrintCell("Slaves",		CH_SLPRICE);	PrintCell("Horses",		CH_HSPRICE);	PrintCell("Oxen", 		CH_OXPRICE);	PrintCell("Land",		CH_LNPRICE);		/* Now draw feed rate frame */		CellRect(CB_TLFEED, CB_BRFEED, "Feed Rates");	PrintCell("Slaves",		CH_SLFEED);	PrintCell("Horses",		CH_HSFEED);	PrintCell("Oxen",		CH_OXFEED);		/* Now draw the overseers frame */		CellRect(CB_TLOV, CB_BROV, "Overseers");	PrintCell("O'seers", 	CH_OV);	PrintCell("Salary",		CH_OVPAY);		/* Now Draw the gold frame */		CellRect(CB_TLLOAN, CB_BRLOAN, "Loan");	PrintCell("Loan",		CH_LOAN);	PrintCell("int %",		CH_INTEREST);	PrintCell("Cred lmt",	CH_CREDLIM);		CellRect(CB_TLGOLD, CB_BRGOLD, "Gold");	PrintCell("Cur Gold",	CH_GOLD);	PrintCell("    ∂%",		CH_DPGOLD);	PrintCell("Old Gold",		CH_OLDGOLD);		CellRect(CB_TLLN, CB_BRLN, "Land");	PrintCell("Fallow",		CH_LNFALLOW);	PrintCell("Planted",		CH_LNSEWN);	PrintCell("Growing",	CH_LNGROWN);	PrintCell("Ripe",		CH_LNRIPE);	PrintCell("Total",		CH_LNTOTAL);		CellRect(CB_TLLM, CB_BRLM, "Spread & Plant");	PrintCell("Manure", 		CH_MNTOSPRD);	PrintCell("Land",		CH_LNTOSEW);		CellRect(CB_TLDATE, CB_BRDATE, "Date");	PrintCell("Year", 		CH_YEAR);	PrintCell("Month",		CH_MONTH);		CellRect(CB_TLPY, CB_BRPY, "Pyramid");	PrintCell("Stone Quota",	CH_PYQUOTA);	PrintCell("Stones",		CH_PYSTONES);	PrintCell("Height", 		CH_PYHEIGHT);		if (debugFlag)		{		CellRect(CB_TLDB, CB_BRDB, "Debug Values");		PrintCell("slHealth", 	CH_SLHEALTH);		PrintCell("hshealth",CH_HSHEALTH);		PrintCell("oxHealth",CH_OXHEALTH);		PrintCell("ovPress",CH_OVPRESS);		PrintCell("slFed",CH_SLFED);		PrintCell("hsFed",CH_HSFED);		PrintCell("oxFed",CH_OXFED);		PrintCell("maxWk_sl",CH_MAXWK_SL);		PrintCell("reqWk",CH_REQWK);		PrintCell("slEff",CH_SLEFF);		PrintCell("slLabor",CH_SLLABOR);		PrintCell("slLashRt",CH_SLLASHRT);		PrintCell("slSickRt",CH_SLSICKRT);		PrintCell("sythed",CH_SYTHED);		PrintCell("totWk",CH_TOTWK);		PrintCell("wkDeff_sl",CH_WKDEFF_SL);		PrintCell("wkHsTend",CH_WKHSTEND);		PrintCell("wkMnSprd",CH_WKMNSPRD);		PrintCell("wkOxTend",CH_WKOXTEND);		PrintCell("wkWtHvst",CH_WKWTHVST);		PrintCell("wkWtSew",CH_WKWTSEW);		PrintCell("wkWtTend",CH_WKWTTEND);		PrintCell("wtEff",CH_WTEFF);		PrintCell("wtLost",CH_WTLOST);		PrintCell("reqWk_sl",CH_RQWK_SL);		PrintCell("posMotive", CH_POSMOTIVE);		PrintCell("negMotive", CH_NEGMOTIVE);		PrintCell("oxEff",CH_OXEFF);		PrintCell("hsEff",CH_HSEFF);		PrintCell("oxMult", CH_OXMULT);		PrintCell("wkAble_sl", CH_WKABLE_SL);		PrintCell("wtSupply", CH_WTSUPPLY);		PrintCell("wtDemand",CH_WTDEMAND);		PrintCell("wtProd", CH_WTPROD);		PrintCell("wtSewn", CH_WTSEWN);		PrintCell("wtGrown", CH_WTGROWN);		PrintCell("wtRipe", CH_WTRIPE);		}	else		CellRect(CB_TLCN, CB_BRCN, "Pending Contracts");		PrintCell("   Run", 		B_RUN);	FrameRoundRect(B_RUN, 5, 5);	PrintCell("   Quit", 		B_QUIT);	FrameRoundRect(B_QUIT, 5, 5);	TextFace(0);	}	/*«Set Status Light»  * Set the status light.  */  VOID StatusLight(s)TEXT *s;	{	if (s && strlen(s))		{		PrintCell(s, L_RUNNING);		InvertRect(L_RUNNING);		}	else		FillRect(L_RUNNING, gray);	}		/*«DebugSet»  * DebugSet -- Toggle the Debug conditions  */VOID DebugSet()	{	debugFlag ^= YES;	/* toggle the flag */	DebugInval();		/* re-display the debug rectangle */	}	/*  * DebugInval -- invalidate the debug rectangle  */  VOID DebugInval()	{	Rect debugRect;		debugRect.top = CB_TLDB->top;	debugRect.left = CB_TLDB->left;	debugRect.bottom = CB_BRDB->bottom;	debugRect.right = CB_BRDB->right;	InvalRect(&debugRect);	}	/*«DrawPyramid»  * Draw Pyramid(b,h) --	Draw the current status of the pyramid whose base is b, and current  *					height is h.  */  DrawPyramid(b,h, tl, br)DOUBLE b,h;Rect *tl, *br;	/* cell rectangles at the top left and bottom right of the pyramid area */	{	PolyHandle poly, PyPoly();		poly = PyPoly(b,h,tl,br);	FillPoly(poly, black);	KillPoly(poly);	}	/*«InvalPyramid»  * InvalPyramid -- Invalidate the region of pyramid growth.  This region is calculated by  *				subtracting the old pyramid from the new pyramid.  */  VOID InvalPyramid(oldHeight, newHeight, b)DOUBLE oldHeight, newHeight, b;	{	PolyHandle oldPyPoly, newPyPoly, PyPoly();	RgnHandle oldPyRgn, newPyRgn, diffPyRgn;		oldPyPoly = PyPoly(b, oldHeight, CB_TLPY, CB_BRPY);	newPyPoly = PyPoly(b, newHeight, CB_TLPY, CB_BRPY);		oldPyRgn = NewRgn();	newPyRgn = NewRgn();	diffPyRgnn = NewRgn();		OpenRgn();	FramePoly(oldPyPoly);	CloseRgn(oldPyRgn);	KillPoly(oldPyPoly);			OpenRgn();	FramePoly(newPyPoly);	CloseRgn(newPyRgn);	KillPoly(newPyPoly);		DiffRgn(newPyRgn, oldPyRgn, diffPyRgn);	InvalRgn(diffPyRgn);		DisposeRgn(newPyRgn);	DisposeRgn(oldPyRgn);	DisposeRgn(diffPyRgn);	}	